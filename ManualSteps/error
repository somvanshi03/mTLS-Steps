# Get the pod name
POD=$(kubectl get pods -n flows-pen-test -l app=haproxy-egress -o jsonpath='{.items[0].metadata.name}')

# Describe the pod to see volume mount issues
kubectl describe pod $POD -n flows-pen-test

# Check the pod's events
kubectl get events -n flows-pen-test --field-selector involvedObject.name=$POD

# Check the deployment's volume mounts
kubectl get deployment -n flows-pen-test haproxy-egress -o yaml | grep -A 15 "volumes:"
kubectl get deployment -n flows-pen-test haproxy-egress -o yaml | grep -A 15 "volumeMounts:"



      volumes:
        - name: mtls
          secret:
            secretName: {{ .Values.mtls.secretName }}
            defaultMode: 0444
            items:
            {{- range .Values.mtls.domains }}
            - key: {{ .name }}-ca-bundle.crt
              path: {{ .name }}-ca-bundle.crt
            - key: {{ .name }}-client-combined.pem
              path: {{ .name }}-client-combined.pem
            {{- end }}



          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: false
            runAsNonRoot: true
            runAsUser: 1000
            runAsGroup: 1000
